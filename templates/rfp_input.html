<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุฅูุดุงุก RFP | Smart RFP AI</title>

  <!-- ๐น ุงูุชูุณููุงุช -->
  <link rel="stylesheet" href="{{ url_for('static', filename='input.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>

<body lang="ar" dir="rtl">
  <!-- ๐น ุงูููุฏุฑ -->
  <header class="topbar">
    <div class="topbar-right">
      <a href="/" class="logo">Smart RFP AI</a>
    </div>
    <nav class="topbar-center">
      <a href="/" id="nav-home">ุงูุฑุฆูุณูุฉ</a>
      <a href="/rfp_input" class="active" id="nav-generate">ุฅูุดุงุก RFP</a>
      <a href="/comparison" id="nav-compare">ููุงุฑูุฉ ุงูุนุฑูุถ</a>
    </nav>
  </header>

  <!-- ๐น ุงููุญุชูู -->
  <div class="form-container">

    <!-- โ ููุง ุงูุชุบููุฑ ุงููุญูุฏ: ุฃุฒููุง action ู method -->
    <form id="rfpForm" novalidate>

      <!-- โ ุงูุฎุทูุฉ 1: ุงูููุฏูุฉ -->
      <div class="form-step active">
        <h2>ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููููุงูุณุฉ</h2>
        <h3>ุงูููุฏูุฉ </h3>

        <label>ุงุณู ุงูููุงูุณุฉ</label>
        <input type="text" name="Competition_Name" placeholder="ูุซูุงู: ูุดุฑูุน ุฅูุดุงุก ูุจูู ุฅุฏุงุฑู" required>

        <label>ุฑูู ุงููุฑุงุณุฉ</label>
        <input type="text" name="Booklet_Number" placeholder="ูุซูุงู: RFP-2025-001" >

        <label>ุชุงุฑูุฎ ุทุฑุญ ุงููุฑุงุณุฉ</label>
        <input type="date" name="Issue_Date" >

        <label>ุงูุฌูุฉ ุงูุญููููุฉ</label>
        <input type="text" name="Government_Agency" placeholder="ูุฒุงุฑุฉ ุงูุจูุฆุฉ ูุงูููุงู ูุงูุฒุฑุงุนุฉ" required>

        <label>ุชูุงููู ูุซุงุฆู ุงูููุงูุณุฉ (ุฑูุงู)</label>
        <input type="number" name="Competition_Document_Fees" placeholder="ุฃุฏุฎู ุงููุจูุบ ุจุงูุฑูุงู" >

        <h3>ุขููุฉ ุงูุฏูุน</h3>
        <div class="checkbox-group">
          <label><input type="checkbox" name="Payment_Method" value="ุดูู"> ุดูู ูุตุฏู</label>
          <label><input type="checkbox" name="Payment_Method" value="ุญูุงูุฉ"> ุญูุงูุฉ ุจูููุฉ</label>
          <label><input type="checkbox" name="Payment_Method" value="ูุธุงู ุณุฏุงุฏ"> ูุธุงู ุณุฏุงุฏ</label>
        </div>

        <h3>ููุซู ุงูุฌูุฉ ุงูุญููููุฉ</h3>
        <label>ุงูุงุณู</label>
        <input type="text" name="Name_of_Government_Agency_Representative" placeholder="ุฃุฏุฎู ุงุณู ุงูููุซู" >

        <label>ุงููุธููุฉ</label>
        <input type="text" name="Position_of_Government_Agency_Representative" placeholder="ูุซูุงู: ูุฏูุฑ ุงููุดุชุฑูุงุช" >

        <label>ุงููุงุชู</label>
        <input type="text" name="Phone_Number_of_Government_Agency_Representative" placeholder="05xxxxxxxx">

        <label>ุงููุงูุณ</label>
        <input type="text" name="Fax_Number_of_Government_Agency_Representative" placeholder="011xxxxxxx">

        <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" name="Email_of_Government_Agency_Representative" placeholder="example@domain.sa">

        <h3>ุนููุงู ููุงู ุงูุชุณููู</h3>
        <label>ุงูุนููุงู</label>
        <input type="text" name="Bid_Submission_Address" placeholder="ุงููุฏููุฉุ ุงูุญูุ ุงูุดุงุฑุน">

        <label>ุงููุจูู</label>
        <input type="text" name="Bid_Submission_Building" placeholder="ูุซูุงู: ูุจูู ุฑูู 12">

        <label>ุงูุทุงุจู</label>
        <input type="text" name="Bid_Submission_Floor" placeholder="ูุซูุงู: ุงูุซุงูุซ">

        <label>ุงูุบุฑูุฉ / ุงูุฅุฏุงุฑุฉ</label>
        <input type="text" name="Bid_Submission_Department_Name" placeholder="ุฅุฏุงุฑุฉ ุงููุดุชุฑูุงุช">

        <label>ููุช ุงูุชุณููู</label>
        <input type="text" name="Bid_Submission_Time" placeholder="ูู ุงูุณุงุนุฉ 8 ุตุจุงุญุงู ุฅูู 12 ุธูุฑุงู">
      </div>

      <!-- โ ุงูุฎุทูุฉ 2 -->
      <div class="form-step">
        <h2>ูุชุทูุจุงุช ุชูุฏูู ุงูุนุฑูุถ</h2>

        <label>ุงุฑูุงู ููุญู ูุนุงููุฑ ุงูุชุฃููู</label>
        <input type="number" name="Post_Qualification" placeholder="ูุซูุงู: 5">

        <label>ูุชุฑุฉ ุงุฑุณุงู ุงูุฃุณุฆูุฉ ูุงูุงุณุชูุณุงุฑุงุช</label>
        <input type="number" name="Inquiry_Submission_period" placeholder="ุฎูุงู 5 ุฃูุงู">

        <label>ูุชุฑุฉ ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ูุงูุงุณุชูุณุงุฑุงุช</label>
        <input type="number" name="Inquiry_Response_Period" placeholder="ุฎูุงู 10 ุฃูุงู">

        <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุฑุฏ ุนูู ุงูุฃุณุฆูุฉ ูุงูุงุณุชูุณุงุฑุงุช</label>
        <input type="email" name="Inquiry_Email" placeholder="example@domain.sa">

        <label>ูุณุจุฉ ุงูุถูุงู ุงูุงุจุชุฏุงุฆู (%)</label>
        <input type="number" name="Initial_Guarantee_Percentage" placeholder="ูุซูุงู: 5 %">

        <h3>ุฎูุงุฑุงุช ุฅุถุงููุฉ</h3>

        <label><input type="checkbox" name="include_Joint_Venture" checked> ุงูุชุถุงูู (ุงูุชุฑุงุถู)</label><br>
        <label><input type="checkbox" name="include_Tender_Split_Section"> ุชุฌุฒุฆุฉ ุงูููุงูุณุฉ</label><br>
        <label><input type="checkbox" name="include_Alternative_Offers"> ุงูุนุฑูุถ ุงูุจุฏููุฉ</label><br>
        <label><input type="checkbox" name="include_Insurance"> ุงูุชุฃูููุงุช</label><br>

        <h3>ุทุจูุนุฉ ุงููุดุฑูุน</h3>
        <select name="Project_Type">
          <option value="ุชุดุบูู ูุตูุงูุฉ">ุชุดุบูู ูุตูุงูุฉ</option>
          <option value="ุงุณุชุดุงุฑุงุช">ุงุณุชุดุงุฑุงุช</option>
          <option value="ูุดุฑูุน ููุฏุณู / ุฅูุดุงุฆู">ูุดุฑูุน ููุฏุณู / ุฅูุดุงุฆู</option>
          <option value="ุชุทููุฑ ุฃูุธูุฉ / ูุดุฑูุน ุชููู">ุชุทููุฑ ุฃูุธูุฉ / ูุดุฑูุน ุชููู</option>
        </select>

        <h3>ูุฏุฉ ุงููุดุฑูุน (ุจุงูุฃุดูุฑ)</h3>
        <input type="number" name="Project_Duration" placeholder="ูุซูุงู: 12">

        <h3>ุฃุณููุจ ุงูุชุฑุณูุฉ</h3>
        <select name="Award_Method">
          <option value="Best Technical Offer">ุงูุฃูุถู ูู ุงููุงุญูุฉ ุงููููุฉ</option>
          <option value="Best Value">ุงููููุฉ ุงูุฃูุถู</option>
          <option value="Lowest Price">ุฃูู ุณุนุฑ</option>
        </select>

        <h3>ูู ูุดูู ุงููุดุฑูุน ุชูุฑูุฏ ุฃุฌูุฒุฉ ุฃู ูุนุฏุงุชุ</h3>
        <select name="Includes_Equipment">
          <option value="no">ูุง</option>
          <option value="yes">ูุนู</option>
        </select>

        <label>ูุชุทูุจุงุช ุงููุญุชูู ุงููุญูู (ุงุฎุชูุงุฑู)</label>
        <input type="text" name="Local_Content_Requirements" placeholder="ูุซูุงู: ุงูุงูุชุฒุงู ุจูุณุจุฉ 30% ูุญุชูู ูุญูู">
      </div>

      <!-- โ ุงูุฎุทูุฉ 3: ุงูุฌุฒุงุกุงุช -->
      <div class="form-step">
        <h2>ุดุฑูุท ูุฃุญูุงู ุงูุชุนุงูุฏ</h2>

        <h3>ุงูุบุฑุงูุงุช ูุงูุฌุฒุงุกุงุช</h3>

        <div class="checkbox-group">
          <label><input type="checkbox" name="Penalty_Deduction"> ุงูุญุณู ูู ุงููุณุชุญูุงุช ุงููุงููุฉ</label><br>
          <label><input type="checkbox" name="Penalty_Execute_On_Vendor"> ุชูููุฐ ุงูุฃุนูุงู ุนูู ุญุณุงุจ ุงููุชุนุงูุฏ</label><br>
          <label><input type="checkbox" name="Penalty_Suspend"> ุฅููุงู ุงูุฃุนูุงู ูุคูุชุงู ูุฅุดุนุงุฑ ุงููุชุนุงูุฏ</label><br>
          <label><input type="checkbox" name="Penalty_Termination"> ุณุญุจ ุงููุดุฑูุน ููุณุฎ ุงูุนูุฏ</label><br>
        </div>

        <label>ูุณุจุฉ ุฅุฌูุงูู ุงูุบุฑุงูุฉ ูู ุงููููุฉ ุงูุฅุฌูุงููุฉ ููุนูุฏ (%)</label>
        <input type="number" name="Max_Penalty_Percentage" placeholder="ูุซูุงู: 20 %">

        <label>ููุงู ุนูู ุงููุดุฑูุน</label>
        <input type="text" name="Service_Execution_Location" placeholder="ูุซูุงู: ูุฏููุฉ ุงูุฑูุงุถ">
      </div>

      <!-- โ ุงูุฎุทูุฉ 4: ุฌุฏูู ุงููููุงุช -->
      <div class="form-step">
        <section class="table-generator quantities-section">
          <h3>๐งพ ุฌุฏูู ุงููููุงุช ูุงูุฃุณุนุงุฑ</h3>
          <textarea id="quantitiesInput" rows="5" placeholder="ุฃุฏุฎู ุงูููุงุฏ ูุงููููุงุช"></textarea>

          <div class="button-group">
            <button id="quantitiesGenerateBtn" type="button" class="btn-generate">โ๏ธ ุชูููุฏ ุงูุฌุฏูู</button>
            <button id="quantitiesSaveBtn" type="button" class="btn-save" style="display:none;">๐พ ุญูุธ ุงูุฌุฏูู</button>
          </div>

          <p id="quantitiesLoading" class="loading-msg" style="display:none;">ุฌุงุฑู ุชูููุฏ ุงูุฌุฏูู...</p>
          <div id="quantitiesTableContainer" class="generated-table-container"></div>
        </section>
      </div>

      <!-- โ ุงูุฎุทูุฉ 5: ุฌุฏูู ููุงุตูุงุช ุงูููุงุฏ -->
      <div class="form-step">
        <section class="table-generator materials-section">
          <h3>โ๏ธ ุฌุฏูู ููุงุตูุงุช ุงูููุงุฏ</h3>
          <textarea id="materialsInput" rows="5" placeholder="ูุซูุงู: ุฎุฑุณุงูุฉ ูุฆุฉ C30 ุจุณูุงูุฉ 20 ุณู"></textarea>

          <div class="button-group">
            <button id="materialsGenerateBtn" type="button" class="btn-generate">โ๏ธ ุชูููุฏ ุงูุฌุฏูู</button>
            <button id="materialsSaveBtn" type="button" class="btn-save" style="display:none;">๐พ ุญูุธ ุงูุฌุฏูู</button>
          </div>

          <p id="materialsLoading" class="loading-msg" style="display:none;">ุฌุงุฑู ุชูููุฏ ุงูุฌุฏูู...</p>
          <div id="materialsTableContainer" class="generated-table-container"></div>
        </section>
      </div>

      <!-- โ ุงูุฎุทูุฉ 6: ุฌุฏูู ุงููุนุฏุงุช -->
      <div class="form-step">
        <section class="table-generator equipment-section">
          <h3>๐ง ุฌุฏูู ููุงุตูุงุช ุงููุนุฏุงุช</h3>
          <textarea id="equipmentInput" rows="5" placeholder="ูุซูุงู: ุญูุงุฑุฉ 2 ุ ุฑุงูุนุฉ 1"></textarea>

          <div class="button-group">
            <button id="equipmentGenerateBtn" type="button" class="btn-generate">โ๏ธ ุชูููุฏ ุงูุฌุฏูู</button>
            <button id="equipmentSaveBtn" type="button" class="btn-save" style="display:none;">๐พ ุญูุธ ุงูุฌุฏูู</button>
          </div>

          <p id="equipmentLoading" class="loading-msg" style="display:none;">ุฌุงุฑู ุชูููุฏ ุงูุฌุฏูู...</p>
          <div id="equipmentTableContainer" class="generated-table-container"></div>
        </section>
      </div>

      <!-- โ ุงูุฎุทูุฉ 7: ุฌุฏูู ุงูุนูุงู -->
      <div class="form-step">
        <section class="table-generator workers-section">
          <h3>๐ท ุฌุฏูู ุงูุนูุงู</h3>

          <textarea id="workersInput" rows="5"
            placeholder="ูุซูุงู: ููู ููุฑุจุงุก 2 ุ ุนุงูู ูุธุงูุฉ 5 ุ ูููุฏุณ ูููุน 1"></textarea>

          <div class="button-group">
            <button id="workersGenerateBtn" type="button" class="btn-generate">โ๏ธ ุชูููุฏ ุงูุฌุฏูู</button>
            <button id="workersSaveBtn" type="button" class="btn-save" style="display:none;">๐พ ุญูุธ ุงูุฌุฏูู</button>
          </div>

          <p id="workersLoading" class="loading-msg" style="display:none;">ุฌุงุฑู ุชูููุฏ ุงูุฌุฏูู...</p>
          <div id="workersTableContainer" class="generated-table-container"></div>
        </section>
      </div>

      <!-- โ ุงูุฎุทูุฉ 8: ุงููุฑุงุฌุนุฉ -->
      <div class="form-step">
        <h2>ูุฑุงุฌุนุฉ ูุฅูุดุงุก RFP</h2>
        <div class="review-header">
          <p>ูุฑุฌู ูุฑุงุฌุนุฉ ุฌููุน ุงูุจูุงูุงุช ูุจู ุฅูุดุงุก ุงููุซููุฉ.</p>
        </div>

        <div class="review-box" id="review-box"></div>

        <div class="generate-section">
          <button type="button" id="generateBtn" class="generate-btn">ุฅูุดุงุก ูุซููุฉ RFP</button>
          <p id="loadingText" class="loading-msg" style="display:none;">ุฌุงุฑู ุฅูุดุงุก ุงููุซููุฉ <span id="dots"></span></p>
        </div>
      </div>

      <div class="form-navigation">
        <button type="button" id="prevBtn">ุงูุณุงุจู</button>
        <button type="button" id="nextBtn">ุงูุชุงูู</button>
      </div>

    </form>
  </div>

  <!-- โ ุงูุณูุฑุจุชุงุช -->
  <script src="{{ url_for('static', filename='input.js') }}"></script>


  <!-- โ ุงูุณูุฑุจุช ุงูุฐู ูุฏุนู Streaming ุนุจุฑ SSE -->
  <script>
document.getElementById("generateBtn").addEventListener("click", function (e) {
    e.preventDefault();

    const form = document.getElementById("rfpForm");
    const formData = new FormData(form);

    const params = new URLSearchParams();
    for (const pair of formData.entries()) {
        params.append(pair[0], pair[1]);
    }

    document.getElementById("loadingText").style.display = "block";
    document.getElementById("generateBtn").disabled = true;

    const evtSource = new EventSource(`/rfp_generate?${params.toString()}`);

    evtSource.onmessage = function(event) {
        const data = JSON.parse(event.data);

        if (data.decisions) {
            document.getElementById("review-box").innerHTML =
                "<pre>" + JSON.stringify(data.decisions, null, 2) + "</pre>";
        }

        if (data.done === true) {
            evtSource.close();
            window.location.href = "/rfp_generate_done";
        }
    };

    evtSource.onerror = function(err) {
        console.error("โ Stream Error:", err);
        evtSource.close();
    };
});
  </script>

</body>
</html>
